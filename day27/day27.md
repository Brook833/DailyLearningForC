2022.10.7
学习C++primer  6.3返回类型和return语句


### 返回类型和return语句
return语句终止当前正在执行的函数并将控制权返回到调用该函数的地方。

### 无返回值函数
没有返回值的return语句只能用在返回类型是void的函数中。这类函数的最后一句后面会隐式的执行return。

通常情况下，void函数如果想在它的中间位置提前退出，可以使用return语句。

### 有返回值的函数
return expression;

return语句的第二种形式提供了函数的结果。只要函数的返回类型不是void，则该函数内的每个retun语句必须返回一个值。必须与函数的返回类型相同，或者能隐式地转换成函数的返回类型。

尽管C++无法确保结果的正确性，但是可以保证每个return语句的结果类型正确。

### 值是如何被返回的
返回一个值的方式和初始化一个变量或形参的方式完全一样：返回的值用于初始化调用点的一个临时量，该临时量就是函数调用的结果。

同其他引用类型一样，如果函数返回引用，则该引用仅是它所引对象的一个别名。
```
const string &shorterString(const string &s1, const string &s2)
{
    return s1.size() <= s2.size() ? s1 : s2;
}
```
其中形参和返回类型都是const string的引用，不管是调用函数还是返回结果都不会真正拷贝string对象

### 不要返回局部对象的引用或指针
函数完成后，它所占用的存储空间也随之被释放掉，因此，函数中止意味着局部变量的引用将指向不再有效的内存区域
```
const string &manip()
{
    string ret;
    if (!ret.empty()) {
        return ret;   // 错误：返回局部对象的引用
    } else {
        return "Hello World";  // 错误：字符串是一个局部变量。
    }
}
```
返回局部对象的引用时错误的；同样，返回局部对象的指针也是错误的。一旦函数完成，局部对象被释放，指针将指向一个不存在的对象。

### 返回类类型的函数和调用运算符
和其他运算符一样，调用运算符也有优先级和结合律。调用运算符的优先级与点运算符和箭头运算符相同，并且也符合左结合律。

如果函数返回指针，引用或类的对象，我们就是能使用函数调用的结果访问结果对象的成员。

### 引用返回左值
函数的返回类型决定函数调用是否是左值。调用一个返回引用的函数得到左值，其他返回类型得到右值。

### 列表初始化返回值
C++11规定，函数可以返回花括号包围的值的列表。类似其他返回结果，此处的列表也用来对表示函数返回的临时量进行初始化。如果列表为空，临时量执行值初始化；否则，返回的值由函数的返回类型决定。

如果函数返回的是内置类型，则花括号包围的列表最多包含一个值，而且该值所占的空间不应该大于目标类型的空间。

### 主函数main的返回值
如果函数不是void，那么它必须返回一个值，但是这个规则有个例外：我们允许main函数没有return语句直接结束。如果控制到达了main函数的结尾而且没有return语句，编译器将隐式地插入一条返回0的return语句。

main函数的返回值可以看作是状态指示器。返回0表示执行成功，其他值表示执行失败，其中非0值的具体含义依机器而定。为了使返回值与机器无关，cstdlib头文件定义了两个预处理变量，我们可以使用这两个变量分别表示成功与失败。

### 递归
如果一个函数调用了它自身，不管这种调用是直接的还是间接的，都称该函数为递归函数。

在递归函数中，一定有某条路径是不包含递归调用的；否则，函数将永远递归下去，换句话说，函数将不断地调用它自身知道程序栈空间耗尽位置。我们有时会说这种函数含有递归循环。