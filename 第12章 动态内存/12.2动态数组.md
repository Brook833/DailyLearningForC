## 12.2 动态数组
new和delete运算符一次分配/释放一个对象，但某些应用需要一次为很多对象分配内存的功能。例如，vector和string都是在连续内存中保存他们的元素，因此，当容器需要重新分配内存时，必须一次性为很多元素分配内存。

为了支持这种需求，C++语言和标准提供了两种一次分配一个对象数组的方法。C++语言定义了另一种new表达式语法，可以分配并初始化一个对象数组。标准库中包含一个名为allocator的类，允许我们将分配和初始化分离。使用allocator通常会提供更好的性能和更灵活的内存管理能力。

很多(可能是大多数)应用都没有直接访问动态数组的需求。当一个应用需要可变数量的对象时，我们在StrBlob中采用的方法几乎总是更简单、更快速并且更安全的————即，使用vector(或其他标准库容器)。使用标准库容器的优势在新标准下更为显著。在支持新标准的标准库中，容器操作比之前的版本要快速的多。

**Best practices:大多数应用应该使用标准库容器而不是动态分配的数组。使用容器更为简单、更不容易出现内存管理错误并且可能由更好的性能。**

如前所述，使用容器的类可以使用默认版本的拷贝、赋值和析构操作。分配动态数组的类则必须定义自己版本的操作，在拷贝、赋值以及销毁对象时管理所关联的内存。

### 12.2.1 new和数组
为了让new分配一个对象数组，我们要在类型名之后跟一对方括号，在其中指明要分配的对象的数目。在下例中，new分配要求数量的对象并(假定分配成功后)返回指向第一个对象的指针:

```c++
// 调用get_size确定分配多少个int
int *pia = new int[get_size()];  // pia指向第一个int
```

方括号中的大小必须是整形，但不必是常量。

也可以用一个表示数组类型的类型别名来分配一个数组，这样，new表达式中就不需要方括号了:

```c++
typedef int arrT[42];  // arrT表示42个int的数组类型
int *p = new arrT;  // 分配一个42个int的数组;p指向第一个int
```

在本例中，new分配一个int数组，并返回指向第一个int的指针。即使这段代码中没有方括号，编译器执行这个表达式时还是会用new[]。即编译器执行如下形式:

```c++
int *p = new int[42];
```

#### 分配一个数组会得到一个元素类型的指针
虽然我们通常称new T[ ]分配的内存为"动态数组",但这种叫法某种程度上有些误导。当用new分配一个数组时，我们并未得到一个数组类型的对象，而是得到一个数组元素类型的指针。即使我们使用类型别名定义了一个数组类型，new也不会分配一个数组类型的对象。在上例中，我们正在分配一个数组的事实甚至都是不可见的————连[num]都没有。new返回的是一个元素类型的指针。

由于分配的内存并不是一个数组类型，因此不能对动态数组调用begin或end。这些函数使用数组维度来返回指向首元素和尾后元素的指针。处于相同的原因，也不能用范围for语句来处理(所谓的)动态数组中的元素。

**WARNING:要记住我们所说的动态数组并不是数组类型**