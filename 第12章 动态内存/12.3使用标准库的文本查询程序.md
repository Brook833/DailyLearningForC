## 12.3 使用标准库:文本查询程序
我们将实现一个简单的文本查询程序，作为标注库相关内容学习的总结。我们的程序允许用户在一个给定文件中查询单词。查询结果是单词在文件中出现的次数及其所在行的列表。如果一个单词在一行中出现多次，此行只列出一次。行会按照升序输出————即，第7行会在第9行之前显示，以此类推。

例如，我们呢可能读入一个包含本章内容(指英文版中的文本)的文件，在其中寻找单词element。输出结果的前几行应该是这样的:

```c++
element occurs 112 times
    (line 36) A set element contains only a key;
    (line 158) operator creates a new element
```

接下来还有大约100行，都是单词element出现的位置

### 12.3.1 文本查询程序设计
开始一个程序的设计的一种好方法是列出程序的操作。了解需要哪些操作会帮助我们分析出需要什么样的数据结构。从需求入手，我们的文本查询程序需要完成如下任务:
> + 当程序读取输入文件时，他必须记住单词出现的每一行。因此，程序需要逐行读取输入文件，并将每一行分解为独立的单词。
> + 当程序输出时
    >> + 它必须能提取每个单词所关联的行号
    >> + 行号必须按升序出现且无重复
    >> + 它必须能打印给定行号中的文本

利用多种标准库设施，我们可以很漂亮的实现这些要求:
> + 我们将使用一个vector<string>来保存整个输入文件的一份拷贝。输入文件中的每行保存为vector中的一个元素。当需要打印一行时，可以用行号作为下标来提取行文本。
> + 我们使用一个istringstream来将每行分解为单词。
> + 我们使用一个set来保存每个单词在输入文本中出现的行号。这保证了每行只出现一次且行号按升序保存。
> + 我们使用一个map来将每个单词与它出现的行号set关联起来。这样我们就可以方便的提取任意单词的set。

我们的解决方案还使用了shared_ptr，原因稍后进行解释。

#### 数据结构
虽然我们可以用vector，set和map来直接编写文本查询程序，但如果定义一个更为抽象的解决方案，会更为有效。我们将从定义一个输入文件的类开始，这会令文件查询更为容易。我们将这个类命名为TextQuery，它包含一个vector和一个map。vector用来保存输入文件的文本，map用来关联每个单词和它出现的行号的set。这个类将会有一个用来读取给定输入文件的构造函数和一个执行查询的操作。

